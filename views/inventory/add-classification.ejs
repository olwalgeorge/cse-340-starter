<%- include('../partials/head') %>
<%- include('../partials/header') %>
<%- include('../partials/navigation') %>

<main>
  <h1><%= title %></h1>
  <%- include('../partials/breadcrumbs') %>
  
  <%# Flash message handling %>
  <%- messages() %>
    <%# Display any validation errors %>
  <% if (typeof errors !== 'undefined' && errors && errors.length > 0) { %>
    <div class="error-messages">
      <ul>
        <% errors.forEach(error => { %>
          <li><%= error.msg %></li>
        <% }) %>
      </ul>
    </div>
  <% } %>
  
  <div class="add-classification-content">
    <h2>Add New Classification</h2>
    <p><strong>Note:</strong> Classification names cannot contain spaces or special characters of any kind.</p>
    
    <form id="addClassificationForm" action="/inv/add-classification" method="post">
      <div class="form-group">
        <label for="classification_name">Classification Name:</label>
        <input 
          type="text" 
          id="classification_name" 
          name="classification_name" 
          required
          pattern="^[a-zA-Z0-9]+$"
          title="Only letters and numbers are allowed"
          value="<%= locals.classification_name || '' %>"
        >
        <span class="field-note">Only letters and numbers allowed</span>
      </div>
      
      <button type="submit" class="btn btn-primary">Add Classification</button>
    </form>
  </div>
</main>

<script>
// Client-side validation
document.getElementById('addClassificationForm').addEventListener('submit', function(e) {
  const classificationInput = document.getElementById('classification_name');
  const pattern = /^[a-zA-Z0-9]+$/;
  
  if (!pattern.test(classificationInput.value.trim())) {
    e.preventDefault();
    alert('Classification name can only contain letters and numbers. No spaces or special characters allowed.');
    classificationInput.focus();
    return false;
  }
  
  if (classificationInput.value.trim().length === 0) {
    e.preventDefault();
    alert('Classification name is required.');
    classificationInput.focus();
    return false;
  }
});

// Real-time validation feedback
document.getElementById('classification_name').addEventListener('input', function() {
  const input = this;
  const pattern = /^[a-zA-Z0-9]+$/;
  
  if (input.value.length > 0 && !pattern.test(input.value)) {
    input.setCustomValidity('Only letters and numbers are allowed');
    input.classList.add('invalid');
    input.classList.remove('valid');
  } else if (input.value.length > 0) {
    input.setCustomValidity('');
    input.classList.add('valid');
    input.classList.remove('invalid');
  } else {
    input.setCustomValidity('');
    input.classList.remove('valid', 'invalid');
  }
});
</script>

<%- include('../partials/footer') %>
