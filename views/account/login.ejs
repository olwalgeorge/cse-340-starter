<% if (title) { %>
  <h1><%= title %></h1>
<% } else {res.redirect('/')} %>

<%- messages() %>

<% if (errors) { %>
  <div class="error-messages" role="alert" aria-live="polite">
    <h2>Please correct the following errors:</h2>
    <ul class="error-list">
      <% errors.array().forEach(error => { %>
        <li><%= error.msg %></li>
      <%})%>
    </ul>
  </div>
<% } %>

<div class="form-container">
  <form id="loginForm" action="/account/login" method="post" novalidate>
    <fieldset>
      <legend>Sign In to Your Account</legend>
      
      <div class="form-group">
        <label for="accountEmail">
          Email Address <span class="required" aria-label="required">*</span>
        </label>
        <input 
          type="email" 
          name="account_email" 
          id="accountEmail" 
          required 
          autocomplete="email"
          aria-describedby="email-help"
          value="<%= locals.account_email || '' %>"
          placeholder="Enter your email address"
          autofocus
        >
        <small id="email-help" class="help-text">The email address you used to register</small>
      </div>
      
      <div class="form-group">
        <label for="accountPassword">
          Password <span class="required" aria-label="required">*</span>
        </label>
        <div class="password-wrapper">
          <input 
            type="password" 
            name="account_password" 
            id="accountPassword" 
            required 
            autocomplete="current-password"
            aria-describedby="password-help"
            placeholder="Enter your password"
          >
          <button type="button" class="password-toggle" aria-label="Show password">
            <span class="show-text">👁️</span>
            <span class="hide-text" style="display: none;">🙈</span>
          </button>
        </div>
        <small id="password-help" class="help-text">Your account password</small>
      </div>
      
      <div class="form-group form-options">
        <label class="checkbox-wrapper">
          <input type="checkbox" id="rememberMe" name="remember_me">
          <span class="checkmark"></span>
          Remember me for 30 days
        </label>
        <a href="/account/forgot-password" class="link-secondary">Forgot your password?</a>
      </div>
      
      <div class="form-group">
        <button type="submit" class="btn btn-primary">
          <span class="btn-text">Sign In</span>
          <span class="btn-loading" style="display: none;">Signing in...</span>
        </button>
      </div>
    </fieldset>
  </form>
  
  <div class="form-footer">
    <p>Don't have an account? <a href="/account/register" class="link-secondary">Create one here</a></p>
    <div class="form-divider">
      <span>or</span>
    </div>
    <div class="social-login">
      <p class="social-text">Sign in with:</p>
      <div class="social-buttons">
        <button type="button" class="btn btn-social btn-google" disabled>
          <span>🔗</span> Google (Coming Soon)
        </button>
        <button type="button" class="btn btn-social btn-facebook" disabled>
          <span>📘</span> Facebook (Coming Soon)
        </button>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Password visibility toggle
  const passwordInput = document.getElementById('accountPassword');
  const toggleButton = document.querySelector('.password-toggle');
  const showText = toggleButton.querySelector('.show-text');
  const hideText = toggleButton.querySelector('.hide-text');
  
  toggleButton.addEventListener('click', function() {
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      showText.style.display = 'none';
      hideText.style.display = 'inline';
      toggleButton.setAttribute('aria-label', 'Hide password');
    } else {
      passwordInput.type = 'password';
      showText.style.display = 'inline';
      hideText.style.display = 'none';
      toggleButton.setAttribute('aria-label', 'Show password');
    }
  });
  
  // Form submission loading state
  const form = document.getElementById('loginForm');
  const submitBtn = form.querySelector('button[type="submit"]');
  const btnText = submitBtn.querySelector('.btn-text');
  const btnLoading = submitBtn.querySelector('.btn-loading');
  
  form.addEventListener('submit', function() {
    submitBtn.disabled = true;
    btnText.style.display = 'none';
    btnLoading.style.display = 'inline';
  });
  
  // Clear loading state if form has errors (page reload)
  if (document.querySelector('.error-messages')) {
    submitBtn.disabled = false;
    btnText.style.display = 'inline';
    btnLoading.style.display = 'none';
  }
  
  // Auto-focus email field if empty
  const emailInput = document.getElementById('accountEmail');
  if (!emailInput.value.trim()) {
    emailInput.focus();
  }
  
  // Real-time validation feedback
  const inputs = form.querySelectorAll('input[required]');
  inputs.forEach(input => {
    input.addEventListener('blur', function() {
      if (this.value.trim() === '') {
        this.classList.add('error');
        this.setAttribute('aria-invalid', 'true');
      } else {
        this.classList.remove('error');
        this.removeAttribute('aria-invalid');
      }
    });
    
    input.addEventListener('input', function() {
      if (this.classList.contains('error') && this.value.trim() !== '') {
        this.classList.remove('error');
        this.removeAttribute('aria-invalid');
      }
    });
  });
});
</script>
